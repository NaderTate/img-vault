{% extends "base.html" %}

{% block content %}
<style>
/* Dashboard specific styles */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 24px;
  margin-bottom: 32px;
}

.stats-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 32px;
}

.stat-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 24px;
  text-align: center;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--brand), #06d6a0);
  opacity: 0.8;
}

.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
  border-color: var(--brand);
}

.stat-number {
  font-size: 2.5rem;
  font-weight: 800;
  color: var(--brand);
  line-height: 1;
  margin-bottom: 8px;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.stat-label {
  font-size: 14px;
  color: var(--muted);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stat-sublabel {
  font-size: 12px;
  color: var(--muted);
  margin-top: 4px;
  opacity: 0.7;
}

.dashboard-section {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 24px;
  transition: all 0.3s ease;
}

.dashboard-section:hover {
  border-color: #2a3441;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
}

.section-title {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--fg);
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.section-title::before {
  content: '';
  width: 4px;
  height: 24px;
  background: var(--brand);
  border-radius: 2px;
}

.progress-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
  padding: 12px 16px;
  background: rgba(255, 255, 255, 0.02);
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.05);
  transition: all 0.2s ease;
}

.progress-item:hover {
  background: rgba(255, 255, 255, 0.05);
  border-color: rgba(255, 255, 255, 0.1);
}

.progress-item:last-child {
  margin-bottom: 0;
}

.progress-info {
  display: flex;
  align-items: center;
  gap: 12px;
  flex: 1;
}

.progress-color {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  flex-shrink: 0;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.progress-label {
  font-weight: 500;
  color: var(--fg);
  flex: 1;
}

.progress-stats {
  display: flex;
  align-items: center;
  gap: 16px;
  font-size: 14px;
}

.progress-count {
  color: var(--brand);
  font-weight: 600;
}

.progress-percentage {
  color: var(--muted);
  min-width: 45px;
  text-align: right;
}

.progress-bar {
  width: 120px;
  height: 6px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 3px;
  overflow: hidden;
  position: relative;
}

.progress-fill {
  height: 100%;
  background: var(--brand);
  border-radius: 3px;
  transition: width 0.3s ease;
  position: relative;
}

.progress-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.latest-images {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 16px;
}

.latest-image {
  aspect-ratio: 1;
  border-radius: 12px;
  overflow: hidden;
  background: #090a0d;
  transition: all 0.3s ease;
  position: relative;
}

.latest-image:hover {
  transform: scale(1.05);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
}

.latest-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}


.workflow-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
}

.workflow-item {
  padding: 20px;
  background: rgba(255, 255, 255, 0.02);
  border: 1px solid rgba(255, 255, 255, 0.05);
  border-radius: 12px;
  text-align: center;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.workflow-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--workflow-color, var(--brand));
}

.workflow-item:hover {
  background: rgba(255, 255, 255, 0.05);
  border-color: var(--workflow-color, var(--brand));
  transform: translateY(-2px);
}

.workflow-count {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--workflow-color, var(--brand));
  margin-bottom: 8px;
}

.workflow-label {
  font-size: 13px;
  color: var(--fg);
  font-weight: 500;
}

.no-data {
  text-align: center;
  color: var(--muted);
  font-style: italic;
  padding: 40px 20px;
}

.quick-actions {
  display: flex;
  gap: 16px;
  margin-bottom: 24px;
  flex-wrap: wrap;
}

.quick-action {
  padding: 12px 20px;
  background: var(--brand);
  color: white !important;
  text-decoration: none;
  border-radius: 8px;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
}

.quick-action:hover {
  background: #5a8bd4;
  color: white !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(122, 162, 255, 0.4);
}

.size-format {
  font-size: 13px;
  color: var(--muted);
  margin-left: 8px;
}

/* Force maximum 3 columns */
@media (min-width: 1400px) {
  .dashboard-grid {
    grid-template-columns: repeat(3, 1fr);
    max-width: 1400px;
    margin: 0 auto;
  }
}

@media (max-width: 1399px) and (min-width: 900px) {
  .dashboard-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 899px) {
  .dashboard-grid {
    grid-template-columns: 1fr;
    gap: 20px;
  }
  
  .stats-row {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
  }
  
  .stat-number {
    font-size: 2rem;
  }
  
  .progress-stats {
    flex-direction: column;
    align-items: flex-end;
    gap: 4px;
  }
  
  .progress-bar {
    width: 80px;
  }
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--muted);
}

.empty-state h3 {
  color: var(--fg);
  margin-bottom: 16px;
  font-size: 1.5rem;
}

.empty-state p {
  margin-bottom: 24px;
  line-height: 1.6;
}
</style>

<div class="quick-actions">
  <a href="/images" class="quick-action">
    üñºÔ∏è Browse Images
  </a>
  <a href="/tags" class="quick-action">
    üè∑Ô∏è Manage Tags
  </a>
  <a href="/settings" class="quick-action">
    ‚öôÔ∏è Settings
  </a>
</div>

{% if total_images == 0 %}
<div class="empty-state">
  <h3>Welcome to Image Vault!</h3>
  <p>Get started by configuring your vault root folder in Settings and scanning your images.</p>
  <a href="/settings" class="quick-action">
    üöÄ Get Started
  </a>
</div>
{% else %}

<!-- Key Statistics -->
<div class="stats-row">
  <div class="stat-card">
    <div class="stat-number">{{ "{:,}".format(total_images) }}</div>
    <div class="stat-label">Total Images</div>
    {% if recent_images_count > 0 %}
    <div class="stat-sublabel">+{{ recent_images_count }} this week</div>
    {% endif %}
  </div>
  
  <div class="stat-card">
    <div class="stat-number">{{ total_tags }}</div>
    <div class="stat-label">Tags</div>
    <div class="stat-sublabel">Categories</div>
  </div>
  
  <div class="stat-card">
    <div class="stat-number">
      {% if total_size >= 1024*1024*1024 %}
        {{ "%.1f"|format(total_size / (1024*1024*1024)) }}
        <span style="font-size: 1rem; color: var(--muted);">GB</span>
      {% elif total_size >= 1024*1024 %}
        {{ "%.1f"|format(total_size / (1024*1024)) }}
        <span style="font-size: 1rem; color: var(--muted);">MB</span>
      {% else %}
        {{ "%.1f"|format(total_size / 1024) }}
        <span style="font-size: 1rem; color: var(--muted);">KB</span>
      {% endif %}
    </div>
    <div class="stat-label">Storage Used</div>
    <div class="stat-sublabel">Total file size</div>
  </div>
  
  {% if last_scan %}
  <div class="stat-card">
    <div class="stat-number" style="font-size: 1.2rem;">{{ last_scan|float|datetime }}</div>
    <div class="stat-label">Last Scan</div>
    <div class="stat-sublabel">{{ root_dir|default("Not set") }}</div>
  </div>
  {% endif %}
</div>

<div class="dashboard-grid">
  <!-- Workflow Status -->
  {% if workflow_stats %}
  <div class="dashboard-section">
    <h2 class="section-title">üìã Workflow Status</h2>
    <div class="workflow-grid">
      {% for workflow in workflow_stats %}
      <div class="workflow-item" style="--workflow-color: {{ workflow.color }}">
        <div class="workflow-count">{{ workflow.count }}</div>
        <div class="workflow-label">{{ workflow.name }}</div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}
  
  <!-- Top Tags -->
  {% if tag_stats %}
  <div class="dashboard-section">
    <h2 class="section-title">üè∑Ô∏è Top Tags</h2>
    {% for tag in tag_stats[:10] %}
    <div class="progress-item">
      <div class="progress-info">
        <div class="progress-color" style="background: {{ tag.color }}"></div>
        <div class="progress-label">{{ tag.name }}</div>
      </div>
      <div class="progress-stats">
        <div class="progress-count">{{ tag.count }}</div>
        <div class="progress-percentage">{{ "%.1f"|format(tag.percentage) }}%</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: {{ tag.percentage }}%; background: {{ tag.color }}"></div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Top Directories -->
  {% if directory_stats %}
  <div class="dashboard-section">
    <h2 class="section-title">üìÅ Top Directories</h2>
    {% for dir in directory_stats %}
    <div class="progress-item">
      <div class="progress-info">
        <div class="progress-color" style="background: var(--brand)"></div>
        <div class="progress-label">{{ dir.name }}</div>
      </div>
      <div class="progress-stats">
        <div class="progress-count">{{ dir.count }}</div>
        <div class="progress-percentage">{{ "%.1f"|format(dir.percentage) }}%</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: {{ dir.percentage }}%"></div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- File Formats -->
  {% if format_stats %}
  <div class="dashboard-section">
    <h2 class="section-title">üìÑ File Formats</h2>
    {% for format in format_stats[:8] %}
    <div class="progress-item">
      <div class="progress-info">
        <div class="progress-color" style="background: #06d6a0"></div>
        <div class="progress-label">{{ format.name|upper }}</div>
      </div>
      <div class="progress-stats">
        <div class="progress-count">{{ format.count }}</div>
        <div class="progress-percentage">{{ "%.1f"|format(format.percentage) }}%</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: {{ format.percentage }}%; background: #06d6a0"></div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Resolution Distribution -->
  {% if resolution_stats %}
  <div class="dashboard-section">
    <h2 class="section-title">üìê Resolution Distribution</h2>
    {% for res in resolution_stats %}
    <div class="progress-item">
      <div class="progress-info">
        <div class="progress-color" style="background: #f59e0b"></div>
        <div class="progress-label">{{ res.name }}</div>
      </div>
      <div class="progress-stats">
        <div class="progress-count">{{ res.count }}</div>
        <div class="progress-percentage">{{ "%.1f"|format(res.percentage) }}%</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: {{ res.percentage }}%; background: #f59e0b"></div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- File Size Distribution -->
  {% if size_stats %}
  <div class="dashboard-section">
    <h2 class="section-title">üíæ File Size Distribution</h2>
    {% for size in size_stats %}
    {% if size.count > 0 %}
    <div class="progress-item">
      <div class="progress-info">
        <div class="progress-color" style="background: #8b5cf6"></div>
        <div class="progress-label">{{ size.name }}</div>
      </div>
      <div class="progress-stats">
        <div class="progress-count">{{ size.count }}</div>
        <div class="progress-percentage">{{ "%.1f"|format(size.percentage) }}%</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: {{ size.percentage }}%; background: #8b5cf6"></div>
        </div>
      </div>
    </div>
    {% endif %}
    {% endfor %}
  </div>
  {% endif %}
</div>

<!-- Latest Images -->
{% if latest_images %}
<div class="dashboard-section">
  <h2 class="section-title">üïí Latest Images</h2>
  <div class="latest-images">
    {% for image in latest_images %}
    <a href="/images/{{ image.id }}" class="latest-image">
      <img src="/thumb/{{ image.id }}?w=150" alt="{{ image.filename }}" />
    </a>
    {% endfor %}
  </div>
</div>
{% endif %}

{% endif %}

<script>
// Add some interactive elements
document.addEventListener('DOMContentLoaded', function() {
  // Add click handlers for stat cards
  document.querySelectorAll('.stat-card').forEach(card => {
    card.addEventListener('click', function() {
      // Add a subtle animation on click
      this.style.transform = 'scale(0.95)';
      setTimeout(() => {
        this.style.transform = '';
      }, 150);
    });
  });

  // Animate progress bars on scroll
  const progressBars = document.querySelectorAll('.progress-fill');
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const bar = entry.target;
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
          bar.style.width = width;
        }, 100);
      }
    });
  });

  progressBars.forEach(bar => observer.observe(bar));

  // Add tooltips for truncated text
  document.querySelectorAll('.progress-label').forEach(label => {
    if (label.scrollWidth > label.clientWidth) {
      label.title = label.textContent;
    }
  });
});
</script>
{% endblock %}